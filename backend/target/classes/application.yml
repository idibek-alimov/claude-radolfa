# ================================================================
# Radolfa – Shared Application Configuration
# ================================================================
# Profile-specific overrides in application-dev.yml / application-prod.yml.
# Default profile is "dev"; override via SPRING_PROFILES_ACTIVE env var.

spring:
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}

  # --- DataSource (PostgreSQL 16) -----------------------------------
  datasource:
    url:              ${DB_URL:jdbc:postgresql://localhost:5432/radolfa_db}
    username:         ${DB_USERNAME:radolfa}
    password:         ${DB_PASSWORD:radolfa}
    driver-class-name: org.postgresql.Driver

  # --- JPA / Hibernate -----------------------------------------------
  jpa:
    hibernate:
      ddl-auto: validate          # Flyway owns every DDL change
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect

  # --- Flyway --------------------------------------------------------
  flyway:
    enabled: true
    locations: classpath:db/migration

  # --- Spring Batch --------------------------------------------------
  batch:
    jdbc:
      initialize-schema: never
    job:
      enabled: false

  # --- Elasticsearch -------------------------------------------------
  elasticsearch:
    uris:
      - ${ELASTICSEARCH_URIS:http://localhost:9200}

# --- Actuator -------------------------------------------------------
management:
  endpoints:
    web:
      exposure:
        include: health, info, metrics
  endpoint:
    health:
      show-details: always

# --- AWS -------------------------------------------------------------
aws:
  s3:
    bucket: ${AWS_S3_BUCKET:radolfa-dev-bucket}

# --- Security / JWT --------------------------------------------------
radolfa:
  security:
    jwt:
      secret: ${JWT_SECRET:dev-secret-key-must-be-at-least-32-characters-long-for-hs256}
      expiration-ms: ${JWT_EXPIRATION_MS:900000}                        # 15 minutes (access token)
      refresh-expiration-ms: ${JWT_REFRESH_EXPIRATION_MS:604800000}     # 7 days (refresh token)
    otp:
      expiration-seconds: 300   # 5 minutes
      length: 4
    rate-limit:
      otp-request-max-per-phone: 5
      otp-request-window-minutes: 60
      otp-verify-max-per-phone: 5
      otp-verify-window-minutes: 15
      ip-max-per-hour: 20
    api-key:
      # Long-lived key for machine-to-machine auth (ERPNext → Backend).
      # Set SYSTEM_API_KEY env var in production (min 32 chars).
      # ERPNext sends this as: X-Api-Key: <value>
      system-key: ${SYSTEM_API_KEY:dev-system-api-key-change-this-in-production!!}
    cors:
      allowed-origins: []
