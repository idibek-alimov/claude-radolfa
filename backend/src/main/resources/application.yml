# ================================================================
# Radolfa â€“ Application Configuration
# ================================================================

# --- DataSource (PostgreSQL 16) -----------------------------------
spring:
  # Active profile (dev by default; override via SPRING_PROFILES_ACTIVE)
  profiles:
    active: dev

  datasource:
    url:              jdbc:postgresql://localhost:5432/radolfa_db
    username:         radolfa
    password:         radolfa
    driver-class-name: org.postgresql.Driver

  # --- JPA / Hibernate -----------------------------------------------
  jpa:
    hibernate:
      ddl-auto: validate          # Flyway owns every DDL change
    show-sql:  false
    properties:
      hibernate:
        format_logger_sql: true
        dialect: org.hibernate.dialect.PostgreSQLDialect

  # --- Flyway --------------------------------------------------------
  flyway:
    enabled: true
    locations: classpath:db/migration

  # --- Spring Batch --------------------------------------------------
  batch:
    jdbc:
      initialize-schema: never   # Spring Batch manages its own metadata tables
    job:
      # launch:
        enabled: false          # Jobs are triggered by the scheduler, not on startup

  # --- Elasticsearch -------------------------------------------------
  elasticsearch:
    uris:
      - http://localhost:9200

# --- Actuator -------------------------------------------------------
management:
  endpoints:
    web:
      exposure:
        include: health, info, metrics
  endpoint:
    health:
      show-details: always

# --- AWS -------------------------------------------------------
aws:
  s3:
    bucket: ${AWS_S3_BUCKET:radolfa-dev-bucket}   # env-var override; default for local dev

# --- Security / JWT --------------------------------------------
radolfa:
  security:
    jwt:
      secret: ${JWT_SECRET:dev-secret-key-must-be-at-least-32-characters-long-for-hs256}
      expiration-ms: ${JWT_EXPIRATION_MS:900000}        # 15 minutes (access token)
      refresh-expiration-ms: ${JWT_REFRESH_EXPIRATION_MS:604800000}  # 7 days (refresh token)
    otp:
      expiration-seconds: 300   # 5 minutes
      length: 4
    rate-limit:
      otp-request-max-per-phone: 5
      otp-request-window-minutes: 60
      otp-verify-max-per-phone: 5
      otp-verify-window-minutes: 15
      ip-max-per-hour: 20
    cors:
      allowed-origins:
        - http://localhost:${HTTP_PORT:80}
        - http://localhost:3000
        - http://localhost:5173
